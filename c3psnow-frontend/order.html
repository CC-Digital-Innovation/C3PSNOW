<!DOCTYPE html>
<html>
  <!-- Metadata for the entire webpage / tab. -->
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstraps. -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <link href="default.css" rel="stylesheet" />
    <link rel="icon" href="./images/C-3PSNOW.png">
    <title>C-3PSNOW</title>
  </head>

  <!-- The contents of the entire webpage. -->
  <body>
    <div class="container py-3 px-3">

      <!-- The header before the fields / buttons. -->
      <header>
        <div class="d-flex">
          <a href="main.html">
            <img
              src="images/C-3PSNOW.png"
              class="me-3 mb-3"
              width="95"
              height="95"
              alt="C-3PSNOW"
            />
          </a>
          <div class="col">
            <p>
              <strong>
                <font size="+2"><strong>Place Order</strong></font>
                <br />
                <span class="fs-1">&larr;</span>
                <small><i>Touch my face to return home.</i></small>
              </strong>
            </p>
          </div>
        </div>
      </header>
      <hr class="mt-0" />

      <!-- Divider for the name field. -->
      <div class="form-floating">
        <input class="form-control" 
          style="background-color: #1F4792; border-color: #1F4792; color:white;"  
          name="the_names"
          id="the_names"
          list="names"
          placeholder="Search Name"
        />
        <label for="the_names">Search Name</label>
        <datalist id="names"></datalist>
      </div>

      <br />

      <!-- Divider for the hole selection dropdown. -->
      <div class="form-floating" >
        <select class="form-select" id="holeDropdown" name="holeDropdown" style="background-color: #1F4792; border-color: #1F4792; color:white;">
          <option value="Hole 1">Hole 1</option>
          <option value="Hole 2">Hole 2</option>
          <option value="Hole 3">Hole 3</option>
          <option value="Hole 4">Hole 4</option>
          <option value="Hole 5">Hole 5</option>
          <option value="Hole 6">Hole 6</option>
          <option value="Hole 7">Hole 7</option>
          <option value="Hole 8">Hole 8</option>
          <option value="Hole 9">Hole 9</option>
          <option value="Hole 10">Hole 10</option>
          <option value="Hole 11">Hole 11</option>
          <option value="Hole 12">Hole 12</option>
          <option value="Hole 13">Hole 13</option>
          <option value="Hole 14">Hole 14</option>
          <option value="Hole 15">Hole 15</option>
          <option value="Hole 16">Hole 16</option>
          <option value="Hole 17">Hole 17</option>
          <option value="Hole 18">Hole 18</option>
        </select>
        <label for="holeDropdown">Hole you are currently playing?</label>
      </div>

      <hr />

      <!-- "Order Cocktails" button. -->
      <button
        class="buttonTeal3"
        id="orderCocktailsButton"
        data-bs-toggle="collapse"
        data-bs-target="#cocktailsList"
        role="button"
        aria-expanded="false"
        aria-controls="cocktailsList"
      >
        Order Cocktails
      </button>

      <!-- "Cocktails" collapsable container. -->
      <div class="collapse" id="cocktailsList">
        <div class="container">
          <center>
            <!-- Fixed "Done" button. -->
            <div class="fixed-bottom">
              <button
                type="button"
                href="#cocktailsList"
                class="visible"
                data-bs-toggle="collapse"
                role="button"
                aria-expanded="false"
                aria-controls="cocktailsList"
                style="background-color: #299fe0; border-color: #299fe0"
              >
                Done
              </button>
            </div>

            <!-- Cocktail 1 row. -->
            <h3><b>Transfusion</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus1"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c1"
                  name="c1"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus1"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 2 row.-->
            <h3><b>Wild Arnold Palmer</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus2"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c2"
                  name="c2"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus2"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 3 row.-->
            <h3><b>Bloody Mary</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus3"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c3"
                  name="c3"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus3"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 4 row.-->
            <h3><b>Dark and Stormy</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus4"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c4"
                  name="c4"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus4"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 5 row.-->
            <h3><b>Apple Cider Bourbon</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus5"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c5"
                  name="c5"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus5"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 6 row.-->
            <h3><b>Coors Light</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus6"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c6"
                  name="c6"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus6"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 7 row.-->
            <h3><b>New Belgium Voodoo Ranger IPA</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus7"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c7"
                  name="c7"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus7"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Cocktail 8 row.-->
            <h3><b>Sam Adams Seasonal</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus8"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c8"
                  name="c8"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus8"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>
          </center>
        </div>
      </div>

      <!-- "Other Drinks" button. -->
      <button
        class="buttonTeal3"
        id="orderotherDrinksButton"
        data-bs-toggle="collapse"
        data-bs-target="#otherDrinksList"
        role="button"
        aria-expanded="false"
        aria-controls="otherDrinksList"
      >
        Other Drinks
      </button>

      <!-- "Other Drinks" collapsable container. -->
      <div class="collapse" id="otherDrinksList">
        <div class="container">
          <center>
            <!-- Fixed "Done" button. -->
            <div class="fixed-bottom">
              <button
                type="button"
                href="#otherDrinksList"
                class="visible"
                data-bs-toggle="collapse"
                role="button"
                aria-expanded="false"
                aria-controls="otherDrinksList"
                style="background-color: #299fe0; border-color: #299fe0"
              >
                Done
              </button>
            </div>

            <!-- Soft Drink 1 row. -->
            <h3><b>Unsweetened Iced Tea</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus9"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c9"
                  name="c9"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus9"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Soft Drink 2 row.-->
            <h3><b>Arnold Palmer</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus10"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c10"
                  name="c10"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus10"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>

            <hr />

            <!-- Water row.-->
            <h3><b>Water</b></h3>
            <div class="row">
              <div class="col">
                <button
                  type="button"
                  id="minus11"
                  class="quantityButton"
                  value="Enabled"
                >
                  -
                </button>
              </div>
              <div class="col">
                <input
                  type="number"
                  id="c11"
                  name="c11"
                  placeholder="0"
                  maxlength="4"
                  size="4"
                />
              </div>
              <div class="col">
                <button
                  type="button"
                  id="plus11"
                  class="quantityButton"
                  value="Enabled"
                >
                  +
                </button>
              </div>
            </div>
          </center>
        </div>
      </div>

      <hr />

      <!-- Priority dropdown. -->
      <div class="form-floating">
        <select class="form-select" id="priority" name="priority" aria-label="Priority" style="background-color: #1F4792; border-color: #1F4792; color:white;">
          <option value="1">Uncontrollable shakes</option>
          <option value="2">Early signs of withdraw</option>
          <option value="3">A bit thirsty</option>
          <option value="3">Need an excuse for poor play</option>
        </select>
        <label for="priorty">Select a Priority</label>
      </div>

      <!-- "Place Order" button (triggers the confirmation modal). -->
      <button
        type="submit"
        id="placeOrder"
        style="background-color: #1f4792; border-color: #1f4792"
        value="sound"
        onclick="playMusic()"
      >
        Place Order
      </button>

      <!-- Footer after the fields / buttons. -->
      <footer>
        <div class="container-fluid text-center">
          <hr />
          <p id="play">ⓒ 2022 Computacenter, Digital Innovation</p>
          <audio src="sounds/order-easteregg.mp3" id="bg-audio">
            Audio not supported.
          </audio>
        </div>
      </footer>
    </div>

    <!-- The success modal. -->
    <div id="successModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-content">
          <br />
          <center>
            <h5 class="modal-title" id="staticBackdropLabel">
              We received your order!
            </h5>
          </center>
            <div class="modal-header" style="visibility: hidden">
                <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
              <center>
                Drinks will be delivered at the next hole.
              </center>
            </div>
            <div class="modal-footer">
                <a href="main.html">
                <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
                </a>
            </div>
        </div>
      </div>
    </div>

    <!-- JavaScript code for back-end hookup. -->
    <script>
      // Const's for getting the names from the NocoDB.
      const url = "https://k3sdev.quokka.ninja/c3psnow";
      const apiKey = "2022_C-3PSNOW";

      // Gets the names from NocoDB.
      async function getNames() {
        const response = await fetch(url + "/noco/getNames", {
          method: "GET",
          headers: {
            "X-API-Key": apiKey,
          },
        });
        return response.json();
      }

      // Adds the names grabbed from NocoDB to the dropdown list.
      let datalist = document.getElementById("names");
      getNames().then((data) => {
        data.forEach((name) => {
          let option = document.createElement("option");
          option.value = name;
          datalist.appendChild(option);
        });
      });

      // Add / sub button initialization.
      var buttonAdd1 = document.getElementById("plus1");
      var buttonSubtract1 = document.getElementById("minus1");
      var buttonAdd2 = document.getElementById("plus2");
      var buttonSubtract2 = document.getElementById("minus2");
      var buttonAdd3 = document.getElementById("plus3");
      var buttonSubtract3 = document.getElementById("minus3");
      var buttonAdd4 = document.getElementById("plus4");
      var buttonSubtract4 = document.getElementById("minus4");
      var buttonAdd5 = document.getElementById("plus5");
      var buttonSubtract5 = document.getElementById("minus5");
      var buttonAdd6 = document.getElementById("plus6");
      var buttonSubtract6 = document.getElementById("minus6");
      var buttonAdd7 = document.getElementById("plus7");
      var buttonSubtract7 = document.getElementById("minus7");
      var buttonAdd8 = document.getElementById("plus8");
      var buttonSubtract8 = document.getElementById("minus8");
      var buttonAdd9 = document.getElementById("plus9");
      var buttonSubtract9 = document.getElementById("minus9");
      var buttonAdd10 = document.getElementById("plus10");
      var buttonSubtract10 = document.getElementById("minus10");
      var buttonAdd11 = document.getElementById("plus11");
      var buttonSubtract11 = document.getElementById("minus11");

      // Order quantity initialization.
      var quantityC1 = document.getElementById("c1");
      var quantityC2 = document.getElementById("c2");
      var quantityC3 = document.getElementById("c3");
      var quantityC4 = document.getElementById("c4");
      var quantityC5 = document.getElementById("c5");
      var quantityC6 = document.getElementById("c6");
      var quantityC7 = document.getElementById("c7");
      var quantityC8 = document.getElementById("c8");
      var quantityC9 = document.getElementById("c9");
      var quantityC10 = document.getElementById("c10");
      var quantityC11 = document.getElementById("c11");

      // Add / sub button logic.
      buttonAdd1.onclick = function () {
        buttonAdd1.style.backgroundColor = "#299FE0";
        buttonSubtract1.style.backgroundColor = "#1F4792";
        quantityC1.value++;
      };
      buttonSubtract1.onclick = function () {
        buttonSubtract1.style.backgroundColor = "#299FE0";
        buttonAdd1.style.backgroundColor = "#1F4792";
        quantityC1.value--;
      };
      buttonAdd2.onclick = function () {
        buttonAdd2.style.backgroundColor = "#299FE0";
        buttonSubtract2.style.backgroundColor = "#1F4792";
        quantityC2.value++;
      };
      buttonSubtract2.onclick = function () {
        buttonSubtract2.style.backgroundColor = "#299FE0";
        buttonAdd2.style.backgroundColor = "#1F4792";
        quantityC2.value--;
      };
      buttonAdd3.onclick = function () {
        buttonAdd3.style.backgroundColor = "#299FE0";
        buttonSubtract3.style.backgroundColor = "#1F4792";
        quantityC3.value++;
      };
      buttonSubtract3.onclick = function () {
        buttonSubtract3.style.backgroundColor = "#299FE0";
        buttonAdd3.style.backgroundColor = "#1F4792";
        quantityC3.value--;
      };
      buttonAdd4.onclick = function () {
        buttonAdd4.style.backgroundColor = "#299FE0";
        buttonSubtract4.style.backgroundColor = "#1F4792";
        quantityC4.value++;
      };
      buttonSubtract4.onclick = function () {
        buttonSubtract4.style.backgroundColor = "#299FE0";
        buttonAdd4.style.backgroundColor = "#1F4792";
        quantityC4.value--;
      };
      buttonAdd5.onclick = function () {
        buttonAdd5.style.backgroundColor = "#299FE0";
        buttonSubtract5.style.backgroundColor = "#1F4792";
        quantityC5.value++;
      };
      buttonSubtract5.onclick = function () {
        buttonSubtract5.style.backgroundColor = "#299FE0";
        buttonAdd5.style.backgroundColor = "#1F4792";
        quantityC5.value--;
      };
      buttonAdd6.onclick = function () {
        buttonAdd6.style.backgroundColor = "#299FE0";
        buttonSubtract6.style.backgroundColor = "#1F4792";
        quantityC6.value++;
      };
      buttonSubtract6.onclick = function () {
        buttonSubtract6.style.backgroundColor = "#299FE0";
        buttonAdd6.style.backgroundColor = "#1F4792";
        quantityC6.value--;
      };
      buttonAdd7.onclick = function () {
        buttonAdd7.style.backgroundColor = "#299FE0";
        buttonSubtract7.style.backgroundColor = "#1F4792";
        quantityC7.value++;
      };
      buttonSubtract7.onclick = function () {
        buttonSubtract7.style.backgroundColor = "#299FE0";
        buttonAdd7.style.backgroundColor = "#1F4792";
        quantityC7.value--;
      };
      buttonAdd8.onclick = function () {
        buttonAdd8.style.backgroundColor = "#299FE0";
        buttonSubtract8.style.backgroundColor = "#1F4792";
        quantityC8.value++;
      };
      buttonSubtract8.onclick = function () {
        buttonSubtract8.style.backgroundColor = "#299FE0";
        buttonAdd8.style.backgroundColor = "#1F4792";
        quantityC8.value--;
      };
      buttonAdd9.onclick = function () {
        buttonAdd9.style.backgroundColor = "#299FE0";
        buttonSubtract9.style.backgroundColor = "#1F4792";
        quantityC9.value++;
      };
      buttonSubtract9.onclick = function () {
        buttonSubtract9.style.backgroundColor = "#299FE0";
        buttonAdd9.style.backgroundColor = "#1F4792";
        quantityC9.value--;
      };
      buttonAdd10.onclick = function () {
        buttonAdd10.style.backgroundColor = "#299FE0";
        buttonSubtract10.style.backgroundColor = "#1F4792";
        quantityC10.value++;
      };
      buttonSubtract10.onclick = function () {
        buttonSubtract10.style.backgroundColor = "#299FE0";
        buttonAdd10.style.backgroundColor = "#1F4792";
        quantityC10.value--;
      };
      buttonAdd11.onclick = function () {
        buttonAdd11.style.backgroundColor = "#299FE0";
        buttonSubtract11.style.backgroundColor = "#1F4792";
        quantityC11.value++;
      };
      buttonSubtract11.onclick = function () {
        buttonSubtract11.style.backgroundColor = "#299FE0";
        buttonAdd11.style.backgroundColor = "#1F4792";
        quantityC11.value--;
      };

      // Music audio for submit button.
      function playMusic() {
        var music = new Audio("sounds/A transport.mp3");
        music.play();
      }

      // Parses the drink value for the given string.
      function parseDrinkValue(drink_val) {
        if (drink_val === "") {
          return 0;
        }

        var val_int = Number(drink_val);

        if (val_int < 0) {
          return 0;
        } else {
          return val_int;
        }
      }

      // Display successful modal.
      function successModal() {
        var modal = document.getElementById("successModal");
        modal.style.display = "block";
      }

      // Submit the order to ServiceNow!
      var submitButton = document.getElementById("placeOrder");
      submitButton.onclick = async (e) => {
        e.preventDefault();

        // Check if the name field was filled in.
        var curr_name = document.getElementById("the_names").value
        if (curr_name == "") {
            alert("Error: Name must be filled out!");
            return;
        } 

        drink_data = {
          "Transfusion": parseDrinkValue(quantityC1.value),
          "Wild Arnold Palmer": parseDrinkValue(quantityC2.value),
          "Bloody Mary": parseDrinkValue(quantityC3.value),
          "Dark and Stormy": parseDrinkValue(quantityC4.value),
          "Apple Cider Bourbon": parseDrinkValue(quantityC5.value),
          "Coors Light": parseDrinkValue(quantityC6.value),
          "New Belgium Voodoo Ranger IPA": parseDrinkValue(quantityC7.value),
          "Sam Adams Seasonal": parseDrinkValue(quantityC8.value),
          "Unsweetened Iced Tea": parseDrinkValue(quantityC9.value),
          "Arnold Palmer": parseDrinkValue(quantityC10.value),
          "Water": parseDrinkValue(quantityC11.value),
        };

        order_payload = {
          name: curr_name,
          drinks: drink_data,
          spec_Instruct: "Special instructions",
          urgency: Number(document.getElementById("priority").value),
          hole_Num: document.getElementById("holeDropdown").value,
        };

        // Beeceptor POST request to see the payload.
        // let beeceptor_resp = await fetch("https://c3psnow.free.beeceptor.com", {
        //   method: "POST",
        //   headers: {
        //     "Content-Type": "application/json"
        //   },
        //   body: JSON.stringify(order_payload)
        // });

        // Sends the order payload to the back-end API.
        let snow_api_resp = await fetch(
          "https://k3sdev.quokka.ninja/c3psnow/sendOrder",
          {
            method: "POST",
            headers: {
              "accept": "application/json",
              "Content-Type": "application/json",
              "X-API-Key": "2022_C-3PSNOW",
            },
            body: JSON.stringify(order_payload),
          }
        );

        // Trigger success modal.
        successModal();
      };
    </script>

    <!-- C-3PO Head audio easter egg. -->
    <script>
      document
        .getElementById("play")
        .addEventListener("click", ({ target }) => {
          document.getElementById("bg-audio").play();
        });
    </script>
  </body>
</html>
